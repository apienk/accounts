<% @parent_col_id = "profile" %>

<% content_for :head do %>
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
  <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.js"></script>
  <%= javascript_include_tag  "profile" %>
  <%# TODO can put x-editable into profile dir and manifest %>
<% end %>

<%= content_for :javascript do %>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".hoverable").hover(function () {
        $(this).toggleClass("hover");
      });

      $('#enable-other-sign-in').click(function(e) {
        e.preventDefault();
        $('.row.other-sign-in').show();
        $(this).hide();
      });

      $.fn.editable.defaults.mode = 'inline';
      $.fn.editable.defaults.send = "always";
      $.fn.editable.defaults.ajaxOptions = {type: "PUT"};
      $.fn.editable.defaults.url = "<%= profile_path %>";

      $('#username').editable();

      $('#name').editable({
        value: {
          title: "<%= current_user.title %>",
          first_name: "<%= current_user.first_name %>",
          last_name: "<%= current_user.last_name %>",
          suffix: "<%= current_user.suffix %>"
        },
        success: function(response, newValue) {
          $(this).html(response.full_name);
        }
      });
    });</script>
<% end %>

<%= page_heading("Your Account") %>

<div class="row name">
  <div class="col-sm-2 category">
    Name
  </div>
  <div class="col-sm-10 info hoverable">
    <a href="#" id="name" class="editable" data-type="profile_name"><%= current_user.guessed_full_name %></a>
    <span class="mod-holder"><span class="glyphicon glyphicon-pencil mod"></span></span>
  </div>
</div>

<div class="row">
  <div class="col-sm-2 category">
    Username
  </div>
  <div class="col-sm-10 info hoverable">
    <a href="#" id="username" class="editable" data-name="username" data-type="text"><%= current_user.username %></a>
  </div>
</div>

<div class="row">
  <div class="col-sm-2 category">
    Emails
  </div>
  <div class="col-sm-10 info hoverable">
    <% current_user.email_addresses.each do |email| %>
      <div class="email">
        <%= email.value %>
        <span class="mod-holder"><span class="glyphicon glyphicon-trash mod"></span></span>
        <div class="properties">
          <%# TODO add a property row with 'Verify this address now!' link if unverified %>
          Searchable <input type="checkbox">
        </div>

      </div>
    <% end %>
    <div><%= link_to "Add an email" %></div>
  </div>
</div>

<%
  all_providers = %w(facebook google twitter identity)

  # The `all providers &` enforces a standard sort order
  current_providers = all_providers & current_user.authentications.collect(&:provider)
  other_providers   = all_providers - current_providers
%>

<div class="row">
  <div class="col-sm-2 category">
    How you<br class="wide"/> sign in
  </div>
  <div class="col-sm-10 info">
    <% current_providers.each do |provider| %>
      <%= way_to_login(provider: provider, has_authentication: true) %>
    <% end %>

    <% if other_providers.any? %>
      <div><%= link_to "Enable other sign in options",nil ,id: 'enable-other-sign-in' %></div>
    <% end %>
  </div>
</div>

<div class="row other-sign-in">
  <div class="col-sm-2 category">
    Other sign in<br class="wide"/> options
  </div>
  <div class="col-sm-10 info">
    <% other_providers.each do |provider| %>
      <%= way_to_login(provider: provider, has_authentication: false) %>
    <% end %>
  </div>
</div>
