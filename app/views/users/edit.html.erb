<% @parent_col_id = "profile" %>

<% content_for :head do %>
  <%= javascript_include_tag  "profile" %>
<% end %>

<%= page_heading("Your Account") %>

<div class="row name">
  <div class="col-sm-2 category">
    Name
  </div>
  <div class="col-sm-10 info">
    <a href="#" id="name" class="editable" data-type="profile_name"><%= current_user.full_name %></a>
  </div>
</div>

<div class="row">
  <div class="col-sm-2 category">
    Username
  </div>
  <div class="col-sm-10 info">
    <a href="#" id="username" class="editable" data-name="username" data-type="text"><%= current_user.username %></a>
  </div>
</div>

<div class="row">
  <div class="col-sm-2 category">
    Emails
  </div>
  <div class="col-sm-10 info">
    <div id="email-template" style="display:none">
      <%= email_entry(value: "", id: "", is_verified: false, is_searchable: "") %>
    </div>
    <% current_user.email_addresses.order(:created_at).each do |email| %>
      <%= email_entry(value: email.value, id: email.id, is_verified: email.verified, is_searchable: email.is_searchable) %>
    <% end %>
    <%= link_to "Add an email", '#', {id: 'add-an-email'} %>
  </div>
</div>

<%
  all_providers = %w(facebook google twitter identity)

  # The `all providers &` enforces a standard sort order
  current_providers = all_providers & current_user.authentications.collect(&:provider)
  other_providers   = all_providers - current_providers
%>

<div class="row">
  <div class="col-sm-2 category">
    How you<br class="wide"/> sign in
  </div>
  <div class="col-sm-10 info">
    <% current_providers.each do |provider| %>
      <%= way_to_login(provider: provider, has_authentication: true) %>
    <% end %>

    <% if other_providers.any? %>
      <div><%= link_to "Enable other sign in options",nil ,id: 'enable-other-sign-in' %></div>
    <% end %>
  </div>
</div>

<div class="row other-sign-in">
  <div class="col-sm-2 category">
    Other sign in<br class="wide"/> options
  </div>
  <div class="col-sm-10 info">
    <% other_providers.each do |provider| %>
      <%= way_to_login(provider: provider, has_authentication: false) %>
    <% end %>
  </div>
</div>


<%= content_for :javascript do %>
<script type="text/javascript">

$('#enable-other-sign-in').click(function(e) {
  e.preventDefault();
  $(this).hide();
  $('.row.other-sign-in').slideToggle();
});

$.fn.editable.defaults.mode = 'inline';
$.fn.editable.defaults.send = "always";
$.fn.editable.defaults.ajaxOptions = {type: "PUT"};
$.fn.editable.defaults.url = "<%= profile_path %>";

$('#username').editable();

$('#name').editable({
  value: {
    title: "<%= current_user.title %>",
    first_name: "<%= current_user.first_name %>",
    last_name: "<%= current_user.last_name %>",
    suffix: "<%= current_user.suffix %>"
  },
  success: function(response, newValue) {
    $(this).html(response.full_name);
  }
});
</script>
<% end # javscript content block %>
