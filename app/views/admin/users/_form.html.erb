<%# Copyright 2011-2012 Rice University. Licensed under the Affero General Public
    License version 3 or later.  See the COPYRIGHT file for details. %>

<% content_for :javascript do %>
  <script type="text/javascript">
    $('.verify-email').bind('ajax:complete', function(evt, xhr, status) {
      $(this).replaceWith(xhr.responseText);
    });</script>
<% end %>

<%= form_for([:admin, @user]) do |f| %>
  <%= render "shared/error_messages", :target => @user %>

  <div class="form-group">
    <%= f.label :username %>
    <div><%= @user.username %></div>
  </div>

  <div class="form-group">
    <%= f.label :name %>
    <div><%= @user.name %></div>
  </div>

  <div class="form-group">
    <%= f.label :first_name %>
    <%= f.text_field :first_name, value: params[:user].nil? ? @user.first_name : params[:user][:first_name] %>
  </div>

  <div class="form-group">
    <%= f.label :last_name %>
    <%= f.text_field :last_name, value: params[:user].nil? ? @user.last_name : params[:user][:last_name] %>
  </div>

  <% unless @user.identity.nil? %>
    <div class="form-group">
      <%= f.label :password %>
      <%= password_field_tag 'user[password]' %>
    </div>

    <div class="form-group">
      <%= f.label :password_confirmation %>
      <%= password_field_tag 'user[password_confirmation]' %>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :existing_email_addresses %>
    <ul>
    <% @user.email_addresses.each do |email| %>
      <li>
      <%= email.value %>
      <% if email.verified %>
        (Verified)
      <% else %>
        <%= link_to 'Mark this email address as verified', admin_verify_contact_info_path(email),
                    remote: true, method: :post,
                    class: 'btn btn-default btn-xs verify-email',
                    confirm: "Are you sure you want to mark \"#{email.value}\" as verified?"
        %>
      <% end %>
      </li>
    <% end %>
    </ul>

    <%= f.label :email_address, 'New email address' %>
    <%= text_field_tag 'user[email_address]', params[:user].try(:[], :email_address) %>
  </div>

  <div class="checkbox">
    <%= f.label :is_administrator, 'Administrator?' %>
    <%= f.check_box :is_administrator %>
  </div>

  <div class="actions">
    <%= f.submit 'Save', class: 'btn btn-default' %>
  </div>
<% end %>
